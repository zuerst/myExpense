{% extends "profile/profileBase.html" %}

{% block content %}
<script type="text/javascript">
$(document).ready(function() {
  $('#daterange span').html(moment().subtract(29, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));

  $('#daterange').daterangepicker({
    format: 'YYYY-MM-DD',
    startDate: '2013-01-01',
    endDate: '2013-12-31',
    ranges: {
       'Today': [moment(), moment()],
       'Last 7 Days': [moment().subtract(6, 'days'), moment()],
       'Last 30 Days': [moment().subtract(29, 'days'), moment()],
       'This Month': [moment().startOf('month'), moment().endOf('month')],
       'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],
       'This Year': [moment().startOf('year'), moment().endOf('year')]
    },
    opens: 'left'},
    function(start, end, label) {
      $('#daterange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
      getReportTable(start.format("YYYY-MM-DD"), end.format("YYYY-MM-DD"));
  });
});

function getReportTable(start, end) {
    console.log(start);
    console.log(end);
    $.ajax({
        beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }},
        url : "/profile/report",
        type : "POST",
        dataType: "json",
        data : { method : "load", startDate : start, endDate: end},
        success : function(response) {
            var tableHTML = ''
            $('#reportTable').empty();
            tableHTML += '<table id="reportTable" class="table table-striped table-bordered">'
            tableHTML +=         '<thead>'
            tableHTML +=         '<tr>'
            tableHTML +=             '<th>#</th>'
            tableHTML +=             '<th>Date</th>'
            tableHTML +=             '<th>Title</th>'
            tableHTML +=             '<th>Description</th>'
            tableHTML +=             '<th>Trans Type</th>'
            tableHTML +=             '<th>Amount</th>'
            tableHTML +=             '<th>Category</th>'
            tableHTML +=             '<th>User</th>'
            tableHTML +=         '</tr>'
            tableHTML +=         '</thead>'
            for (var i = 0; i < response.length; i++) {
                id = response[i]['pk']
                amount = response[i].fields['amount']
                category = response[i].fields['category']
                date = response[i].fields['date']
                description = response[i].fields['description']
                title = response[i].fields['title']
                transType = response[i].fields['transType']
                user = response[i].fields['user']

                tableHTML += '<tr>'
                tableHTML +=        '<td>'+ id + '</td>'
                tableHTML +=        '<td>' + date + '</td>'
                tableHTML +=        '<td>' + title + '</td>'
                tableHTML +=        '<td>' + description +'</td>'
                tableHTML +=        '<td>' + transType + '</td>'
                tableHTML +=        '<td>' + amount + '</td>'
                tableHTML +=        '<td>' + category + '</td>'
                tableHTML +=        '<td>' + user +'</td>'
                tableHTML +=    '</tr>'
            }
            tableHTML += '</tbody> </table>'

            $('#reportTable').html(tableHTML);
            // add dynamic to report table.
            $('#reportTable').dataTable({
                "bDestroy": true
            });
            console.log("success");
            // location.reload();
        }
    })
}
</script>
<div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Report</h1>
                    <div id="daterange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                        <span></span> <b class="caret"></b>
                    </div>
                    <table id="reportTable" class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Date</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Trans Type</th>
                        <th>Amount</th>
                        <th>Category</th>
                        <th>User</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td>{{ t.transID }}</td>
                        <td>{{ t.date }}</td>
                        <td>{{ t.title }}</td>
                        <td>{{ t.description }}</td>
                        <td>{{ t.transType }}</td>
                        <td>{{ t.amount }}</td>
                        <td>{{ t.category }}</td>
                        <td>{{ t.user }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    </table>
                </div>
                <!-- /.col-lg-12 -->
            </div>
</div>
{% endblock %}